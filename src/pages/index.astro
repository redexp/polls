---
import Main from '../layouts/Main.astro';
import LoginButton from '../components/LoginButton.astro';
import Poll from '../components/Poll.astro';
import {formatAddresses} from '@server/config/auth.js';
import {getPolls} from '../lib/polls';

const addr = formatAddresses();
const active = getPolls();
---

<Main>
    <h1 class="display-4 text-center m-5">{import.meta.env.TITLE}</h1>

    <section class="card shadow-soft mb-5 pb-3" aria-labelledby="eligibility-title">
        <div class="card-body d-flex gap-3">
            <div class="flex-shrink-0" aria-hidden="true">
                ℹ️
            </div>
            <div>
                <h2 id="eligibility-title" class="h6 mb-2">Важливо перед початком</h2>
                <p class="mb-1">Щоб ваші відповіді були <strong>зараховані</strong>, необхідно:</p>
                <ol class="mb-2">
                    <li>Пройти ідентифікацію через <strong>BankID</strong></li>
                    <li>Мати адресу реєстрації у
						{
							addr.length === 1 ?
								<strong>{addr[0]}</strong> :
								<ul>
									{addr.map(v => (
										<li>{v}</li>
									))}
								</ul>
						}
					</li>
                </ol>
            </div>
        </div>

        <div class="text-center">
            <LoginButton size="lg"/>
        </div>
    </section>

    {active.length > 0 &&
    <section>
        <h2 class="display-5 text-center mb-5">Поточні опитування</h2>

        {active.map((poll) => (
			<Poll poll={poll}/>
		))}
    </section>}
</Main>